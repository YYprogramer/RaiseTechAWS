# 第４回課題の実装

## 作業の全体像
    1.VPCの作成
    2.セキュリティグループの作成
    3.EC2の作成
    4.RDSの作成
    5.EC2からRDSへ接続
![lecture04_zentaikouseizu.png](img%2Flecture04_zentaikouseizu.png)

---
### 1.VPCの作成
#### VPCとは
 Virtual Private Cloudの略です。*AWS上に個人的な仮想ネットワークを構築する*ために使用します。このVPC内にAWSリソースを配置することで、サービスを構築することができます。
#### VPCを作成する目的
今回の課題ではEC2・RDSの作成及び接続といった、一般的な構築の実装を行うためにVPCを作成します。
#### 実装手順
1. AWSにログイン
2. 検索バーに「VPC」と入力し、サービスから「VPC」を選択します。
![ 2024-05-20 5.25.48.png](img%2F%202024-05-20%205.25.48.png)
3. 「VPCを作成」を選択します。
![ 2024-05-20 5.32.50.png](img%2F%202024-05-20%205.32.50.png)
4. VPCのリソースを作成。今回は名前以外デフォルトの設定を活用しています。
![ 2024-05-20 5.06.49.png](img%2F%202024-05-20%205.06.49.png)
![2024-05-20 5.07.10.png](img%2F2024-05-20%205.07.10.png)
![ 2024-05-20 5.08.53.png](img%2F%202024-05-20%205.08.53.png)
5. 上記4.で「VPCの作成」ボタンをクリックすると自動でリソースを作成してくれます。成功すると下記のように表示されます。
![ 2024-05-20 5.09.27.png](img%2F%202024-05-20%205.09.27.png)
6. 作成したVPCのリソースを確認します。これでVPCは完成です。
![ 2024-05-20 5.10.40.png](img%2F%202024-05-20%205.10.40.png)


---
### 2.セキュリティーグループの作成
#### セキュリティーグループとは
作成したAWSのインスタンスに対して、*どういった通信を許可するのか設定する*作業です。あらかじめグループを作成しておくことにより、後からインスタンスを作成したときに作業の効率化が図れます。
#### セキュリティーグループを作成する目的
今回は、下記の通信を許可するセキュリティグルプを作成します。  
EC2インスタンス・・・SSH通信   
RDSインスタンス・・・MySQL/Aurora
#### 実装手順
1. VPCダッシュボードから「セキュリティーグループ」を選択します。![ 2024-05-22 4.55.53.png](img%2F%202024-05-22%204.55.53.png)
2. 「セキュリティグループを作成」を選択します。![ 2024-05-22 4.59.35.png](img%2F%202024-05-22%204.59.35.png)
3. まずはEC2インスタンスにおけるセキュリティーグループから作成します。
4. 「基本的な詳細」を作成します。![2024-05-23 4.37.52.png](img%2F2024-05-23%204.37.52.png)
5. 今回はインバウンドルールに設定を記述していきます。![ 2024-05-22 5.34.22.png](img%2F%202024-05-22%205.34.22.png)
6. 「セキュリティグループを作菜」をクリックします。画像ではアウトバウンドルールを設定していませんが、デフォルトで設定されているルールを残しておいてください。![ 2024-05-22 5.47.18.png](img%2F%202024-05-22%205.47.18.png)
7. EC2用のセキュリティグループが作成されます。![ 2024-05-22 5.48.34.png](img%2F%202024-05-22%205.48.34.png)
8. 同様にRDSインスタンスにおけるセキュリティグループを作成します。
9. 「セキュリティグループを作成」を選択します。![ 2024-05-22 4.59.35.png](img%2F%202024-05-22%204.59.35.png)
10. 「基本的な詳細」を作成します。![2024-05-23 4.37.52.png](img%2F2024-05-23%204.37.52.png)
11. 続いてインバウンドルールを設定していきます。![ 2024-05-23 4.56.11.png](img%2F%202024-05-23%204.56.11.png)
12. 「セキュリティグループを作成」をクリックします。画像ではアウトバウンドルールを設定していませんが、デフォルトで設定されているルールを残しておいてください。![ 2024-05-23 5.03.24.png](img%2F%202024-05-23%205.03.24.png)
13. RDS用のセキュリティグループが作成されます。![ 2024-05-23 5.06.56.png](img%2F%202024-05-23%205.06.56.png)
14. セキュリティグループの作成は以上になります。![ 2024-05-23 5.07.27.png](img%2F%202024-05-23%205.07.27.png)

#### 補足知識
- CIDR記法（さいだーきほう）
  CIDR記法とは*IPアドレスの割り当て方法の一種*です。  
  EC2は仮想コンピュータを作成する作業であるため、仮想コンピュータ用のIPアドレスを作成する必要があります。  
  この時使用されるのがCIDR記法です。
  通常IPアドレスでは、どのネットワークを使用するかの「ネットワーク部」と、どのコンピュータを使用するかの「ホスト部」を記載しています。  
  CIDR記法では「X.X.X.X/X」という表記でIPアドレスを表します。  
  「X.X.X.X」部分がIPアドレス、「/X」部分がネットワーク部の長さとなります。  
  例えば「X.X.X.X/8」と表記されていた場合  
  「11111111.00000000.00000000.00000000」と表現することができ、この左から８番目までの数字（１）でネットワーク部分を残りの数字（０）でホスト部分を表現しています。
  よって「X.X.X.X/8」の場合「11111111.00000000.00000000.00000000」〜「11111111.11111111.11111111.11111111」は同じネットワークとして扱われます。  
  この「/X」は０〜３２ビット間で設定され、数字が大きくなればなるほど割り振ることができるIPアドレスの数は少なくなります。  
  例えば[10.0.0.0/0]この場合ネットワーク部に０ビット、ホスト部に３２ビット割り振っていますので、約42億種類のIPアドレスを表現できます。  
  続いて[10.0.0.0/16]この場合ネットワーク部に16ビット、ホスト部に16ビット割り振っていますので、約65,000種類のIPアドレスを表現できます。  
  最後に[10.0.0.0/32]この場合ネットワーク部に32ビット、ホスト部に０ビット割り振っていますので、１つのIPアドレスしか表現できません。
#### セキュリティーグループにおけるポート
- SSH…他のコンピュータ（サーバー）に接続し、遠隔操作するための仕組み。AWSサーバーを介してにアクセスするために必要。
- MySQL/Aurora…今回はMySQLを使用してRDSを作成しようとしているのでこのポートが必要。

- リクエストとレスポンス  
  クライアントがサーバーに情報を要求ことを＝リクエスト  
  要求に応じてサーバーからクライアントに情報を返すこと＝レスポンス

- ポート  
  ポートとは*通信において相手のアプリケーションを識別するための番号*のことです。IPアドレスの末尾に割り振られます。

- ウェルノウンポートとエフェメラルポート  
  ウェルノウンポート…よく使用されるプロトコルであるであるため、あらかじめ番号が割り振られているポートのことです。  
  例：ssh→「22」、http→「80」、https→「443」など  
  エフェメラルポート…ウェルノウンポート以外のポート番号。特定の用途に限定されていないため、自由に使用できるが通信が終わるとポートの占用は終了する。クライアント側が通信を受け付ける際、エフェメラルポートの中から自動で番号を割り振って使用することが多い。

- セキュリティグループはステートレスorステートフルどちらか？  
  ステートフル…リクエストで許可したルールは自動的にレスポンスにも適用される。セキュリティグループの設定で使用されている。    
  ステートレス…リクエスト・レスポンスそれぞれに許可するルールを設定する必要がある。ネットワークACLで使用されている。
---
### 3.EC2の作成
#### EC2とは
*仮想のサーバーを作成できる*サービス。VPCが仮想のネットワークで、そこに接続しているパソコンのようなもの。サービスや機能を提供する側のパソコンを設置することができる。
#### EC2を作成する目的
VPC内でEC2・RDSインスタンスを作成し、それぞれ接続させることができるか確認するため
#### 実装手順
1. 検索バーに『EC2』と入力し、サービスぼEC2を選択します。![ 2024-05-24 4.40.25.png](img%2F%202024-05-24%204.40.25.png)
2. 「インスタンスを起動」をクリックします。![ 2024-05-24 4.48.46.png](img%2F%202024-05-24%204.48.46.png)
3. 「名前」を作成し、「アプリケーションおよびOSイメージ」を選択します。![ 2024-05-24 4.53.42.png](img%2F%202024-05-24%204.53.42.png)
4. 「インスタンスタイプ」を選択します。![ 2024-05-24 5.01.35.png](img%2F%202024-05-24%205.01.35.png)
5. キーペアを作成します。![ 2024-05-24 5.11.28.png](img%2F%202024-05-24%205.11.28.png)
6. 続いてネットワーク設定を行います。「編集」をクリックします。![ 2024-05-26 18.20.45.png](img%2F%202024-05-26%2018.20.45.png)
7. VPCを選択します。![ 2024-05-24 5.26.47.png](img%2F%202024-05-24%205.26.47.png)
8. サブネットを選択します。今回はパブリックサブネットを選択しています。![ 2024-05-24 5.27.55.png](img%2F%202024-05-24%205.27.55.png)
9. パブリックIDの自動割り当てを「有効化」にします。![ 2024-05-24 5.28.09.png](img%2F%202024-05-24%205.28.09.png)
10. 今回はこのような設定を行なっています。![ 2024-05-24 5.28.21.png](img%2F%202024-05-24%205.28.21.png)
11. 続いてファイヤーウォール（セキュリティグループ）の設定を行います。「既存のセキュリティグループを選択する」を選択します。![ 2024-05-24 5.28.32.png](img%2F%202024-05-24%205.28.32.png)
12. EC2用に作成したセキュリティグループを選択します。![ 2024-05-24 5.28.52.png](img%2F%202024-05-24%205.28.52.png)
13. 今回はこのようにネットワーク設定を行なっています。![ 2024-05-24 5.29.17.png](img%2F%202024-05-24%205.29.17.png)
14. 「インスタンスを起動」をクリックします。![ 2024-05-24 5.29.35.png](img%2F%202024-05-24%205.29.35.png)
15. 正常に作成できると、このような画面に遷移します。EC2が接続できるか確認するため「インスタンスに接続」をクリックします。![ 2024-05-24 5.29.50.png](img%2F%202024-05-24%205.29.50.png)
16. 今回は警告文が出ていたため、接続ができませんでした。警告文に従って、指定のIPアドレスの接続も許可します。![ 2024-05-24 5.30.32.png](img%2F%202024-05-24%205.30.32.png)
17. EC2用のセキュリティグループを開き、「インバウンドのルールを編集」をクリックします。![ 2024-05-24 5.32.13.png](img%2F%202024-05-24%205.32.13.png)
18. 警告文で指定されていたIPアドレスの接続を許可します。![ 2024-05-24 5.32.48.png](img%2F%202024-05-24%205.32.48.png)
19. もう一度、EC2の接続を確認します。セキュリティグループを編集し、指定のIPアドレスからの接続を許可したため、今回は警告文が表示されていません。![ 2024-05-24 5.33.12.png](img%2F%202024-05-24%205.33.12.png)
20. 「接続」をクリックします。このような画面になれば成功です！![ 2024-05-24 5.33.50.png](img%2F%202024-05-24%205.33.50.png)

---
### 4.RDSの作成
#### RDSとは
AWSが提供する*データベースサービスのこと*
#### RDSを作成する目的
データベースを作成することにより、*データを保存・更新したり管理する*ことができるから。
#### 実装手順
1. 検索バーに「RDS」と入力し、サービスの『RDS』を選択します。![ 2024-05-27 4.29.46.png](img%2F%202024-05-27%204.29.46.png)
2. 「データベースの作成」をクリックします。![ 2024-05-27 4.30.37.png](img%2F%202024-05-27%204.30.37.png)
3. データベース作成方法を選択で「標準作成」を選択します。![ 2024-05-27 4.31.37.png](img%2F%202024-05-27%204.31.37.png)
4. エンジンのオプションで「MySQL」を選択します。![ 2024-05-27 4.32.30.png](img%2F%202024-05-27%204.32.30.png)
5. テンプレートで「無料利用枠」を選択します。![ 2024-05-27 4.33.06.png](img%2F%202024-05-27%204.33.06.png)
6. 設定を作成します。ほとんどデフォルトです。「パスワードを自走生成」にチェックを入れます。![ 2024-05-27 5.10.17.png](img%2F%202024-05-27%205.10.17.png)
7. 「インスタンスの設定」「ストレージ」はデフォルトです。![ 2024-05-27 5.10.40.png](img%2F%202024-05-27%205.10.40.png)
![ 2024-05-27 5.10.52.png](img%2F%202024-05-27%205.10.52.png)
8. 先ほど作成たEC2インスタンスに接続させます。![ 2024-05-27 5.11.43.png](img%2F%202024-05-27%205.11.43.png)![ 2024-05-27 5.12.25.png](img%2F%202024-05-27%205.12.25.png)
9. 作成していたRDSのセキュリティーグループを適用させます。![ 2024-05-27 5.13.08.png](img%2F%202024-05-27%205.13.08.png)![ 2024-05-27 5.13.31.png](img%2F%202024-05-27%205.13.31.png)
10. 「データベースの作成」をクリックします。![ 2024-05-27 5.13.53.png](img%2F%202024-05-27%205.13.53.png)
11. 以上でRDSの作成は終了です。データベースが使えるようになるまで数分かかります。![ 2024-05-28 15.31.58.png](img%2F%202024-05-28%2015.31.58.png)

---
### 5.EC2からRDSへ接続
#### 実装手順
1. EC2インスタンスを接続しターミナル画面を開きます。  
ここで「sudo yum install mysql」を実行すると失敗します。![ 2024-05-29 4.54.15.png](img%2F%202024-05-29%204.54.15.png)  
これはyumがmysqlのパッケージを見つけれらなかったため発生しています。解決のために、公式のMySQLリポジトリからインストールします。
2. ` sudo dnf -y localinstall  https://dev.mysql.com/get/mysql80-community-release-el9-1.noarch.rpm` を実行し公式リポジトリからMySQLをインストール
![ 2024-05-29 4.56.07.png](img%2F%202024-05-29%204.56.07.png)![ 2024-05-29 4.56.25.png](img%2F%202024-05-29%204.56.25.png)
これによりdnfコマンド内でMySQLが使用できるようになります。
3. 続いて`sudo rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2023` を実行しGPGキーをインストールします。
4. 最後に `sudo dnf -y install mysql mysql-community-client` を実行し MySQLをインストールします。![ 2024-05-29 4.57.09.png](img%2F%202024-05-29%204.57.09.png)
5. これによりMySQLが使用できるようになりました。
6. 続いて、`mysql -h エンドポイント -P 3306 -u ユーザー名 -p`を実行し`データベースのパスワードを入力`するとMySQLへ接続できます。![ 2024-06-01 4.36.25.png](img%2F%202024-06-01%204.36.25.png)
